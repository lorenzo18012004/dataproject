import yfinance as yf
import plotly.graph_objects as go
import pandas as pd

# 1. Récupération des données sur 1 an pour NVIDIA
ticker = "NVDA"
df = yf.download(ticker, period="1y", interval="1d")

# Nettoyage des colonnes (indispensable pour les versions récentes de yfinance)
if isinstance(df.columns, pd.MultiIndex):
    df.columns = df.columns.get_level_values(0)

# 2. Création du graphique interactif
fig = go.Figure()

# Ajout des bougies quotidiennes
fig.add_trace(go.Candlestick(
    x=df.index,
    open=df['Open'],
    high=df['High'],
    low=df['Low'],
    close=df['Close'],
    name="Daily Candlestick",
    increasing_line_color='#26a69a', # Vert
    decreasing_line_color='#ef5350'  # Rouge
))

# 3. Ajout d'une moyenne mobile pour l'analyse de tendance
df['MA20'] = df['Close'].rolling(window=20).mean()
fig.add_trace(go.Scatter(
    x=df.index, 
    y=df['MA20'], 
    name='Moving Average (20d)', 
    line=dict(color='#FFA726', width=1.5)
))

# 4. Configuration de l'affichage
fig.update_layout(
    title=f"{ticker} - Full Year Interactive Performance (Daily Candles)",
    template="plotly_dark",
    yaxis_title="Stock Price (USD)",
    xaxis_title="Timeline",
    xaxis_rangeslider_visible=True,
    hovermode='x unified'
)

# Optionnel : Zoomer par défaut sur les 60 derniers jours pour voir les bougies dès l'ouverture
last_date = df.index[-1]
start_zoom = df.index[-60]
fig.update_xaxes(range=[start_zoom, last_date])

# 5. Sauvegarde pour ton URL
fig.write_html("index.html")
fig.show()
